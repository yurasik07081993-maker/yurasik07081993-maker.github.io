<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ì–ï–û–ú–ï–¢–†–ò–ö–ê</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://yandex.ru/ads/system/context.js" async></script>
    <style>
        :root {
            --neon-red: #ff073a; --neon-blue: #00f2ff; --neon-green: #39ff14;
            --neon-yellow: #fff01f; --neon-purple: #b026ff; --bg-dark: #0a0a12;
            --bg-panel: rgba(20, 20, 30, 0.95);
        }
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            user-select: none; -webkit-user-select: none;
            -moz-user-select: none; -ms-user-select: none;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #050508 0%, #1a1a2e 100%);
            color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 100vh;
            margin: 0; padding: 10px; overflow: hidden; touch-action: none;
        }
        #orientation-warning {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); z-index: 9999; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; padding: 20px;
        }
        @media screen and (orientation: landscape) and (max-height: 500px) {
            #orientation-warning { display: flex; }
        }
        #main-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 576px; position: relative; transform: scale(0.9); }
        .top-panel { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; justify-content: space-between; }
        .info-box {
            background: var(--bg-panel); padding: 8px 0; border-radius: 12px;
            text-align: center; flex: 1; border: 2px solid rgba(0, 242, 255, 0.3);
            box-shadow: 0 0 8px rgba(0, 242, 255, 0.1); display: flex; flex-direction: column; justify-content: center;
        }
        .label { font-size: 0.75rem; color: var(--neon-blue); margin-bottom: 2px; text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 0 2px var(--neon-blue); }
        .value { font-size: 1.5rem; font-weight: 800; text-shadow: 0 0 4px rgba(255,255,255,0.6); }
        .win-color { color: var(--neon-green); text-shadow: 0 0 4px var(--neon-green); }
        .lvl-color { color: var(--neon-purple); text-shadow: 0 0 4px var(--neon-purple); }
        
        #game-board {
            display: grid; grid-template-columns: repeat(8, 1fr); gap: 5px; 
            background-color: rgba(15, 15, 25, 0.95); padding: 10px; border-radius: 16px;
            border: 3px solid rgba(0, 242, 255, 0.5); box-shadow: 0 0 20px rgba(0, 242, 255, 0.2), inset 0 0 30px rgba(0, 0, 0, 0.8);
            position: relative; width: 100%; aspect-ratio: 1 / 1; touch-action: none;
        }
        .cell {
            background-color: rgba(45, 45, 65, 0.5); border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; z-index: 1;
        }
        .cell.top-layer { z-index: 100 !important; }
        .cell.bot-layer { z-index: 50 !important; }
        
        .shape {
            width: 100%; height: 100%; position: absolute; pointer-events: none;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 2;
            display: flex; align-items: center; justify-content: center;
            top: 0; left: 0;
        }
        .shape-inner { width: 75%; height: 75%; position: relative; }

        .type-1 .shape-inner { 
            background: var(--neon-red); width: 45%; height: 45%; transform: rotate(45deg); 
            box-shadow: 0 0 3px var(--neon-red); margin-top: 10%;
        }
        .type-1 .shape-inner::before, .type-1 .shape-inner::after { content:""; position:absolute; width:100%; height:100%; background:inherit; border-radius:50%; box-shadow:inherit; }
        .type-1 .shape-inner::before { left:-50%; } .type-1 .shape-inner::after { top:-50%; }
        
        .type-2 .shape-inner { background: var(--neon-blue); border-radius: 20%; box-shadow: 0 0 3px var(--neon-blue), inset 0 0 2px white; }
        .type-3 .shape-inner { background: var(--neon-green); border-radius: 50%; width: 70%; height: 70%; box-shadow: 0 0 3px var(--neon-green), inset 0 0 2px white; }
        .type-4 .shape-inner { background: var(--neon-yellow); transform: rotate(45deg) scale(0.8); border-radius: 12%; box-shadow: 0 0 3px var(--neon-yellow); }
        
        .type-5 .shape-inner::after { 
            content: "üíé"; font-size: min(10vw, 50px); position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); filter: drop-shadow(0 0 1.5px rgba(0, 242, 255, 0.8)); animation: pulse 2s infinite; 
        }

        @keyframes pulse { 0%, 100% { filter: drop-shadow(0 0 1.5px rgba(0, 242, 255, 0.7)); } 50% { filter: drop-shadow(0 0 3px rgba(0, 242, 255, 0.9)); } }
        .controls { margin-top: 10px; display: flex; gap: 10px; width: 100%; }
        button {
            padding: 15px; font-size: 1.1rem; cursor: pointer; border: 2px solid transparent;
            color: white; border-radius: 12px; font-weight: bold; background: rgba(0,0,0,0.3);
            text-transform: uppercase; letter-spacing: 1px; transition: 0.1s; display: flex; align-items: center; justify-content: center;
        }
        button:active { transform: scale(0.96); }
        .btn-action { flex: 2; }
        .btn-icon { flex: 1; max-width: 70px; font-size: 1.5rem; padding: 10px; }
        .btn-bomb { border-color: var(--neon-red); color: var(--neon-red); }
        .btn-restart { border-color: var(--neon-blue); color: var(--neon-blue); }
        .btn-sound { border-color: var(--neon-purple); color: var(--neon-purple); }
        #modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; border-radius: 16px;
        }
        .modal-content {
            background: rgba(20, 20, 40, 0.95); border: 2px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.3); padding: 30px; border-radius: 20px;
            text-align: center; width: 80%; max-width: 400px; animation: appearPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-title { font-size: 2rem; margin-bottom: 10px; text-transform: uppercase; text-shadow: 0 0 10px white; }
        .modal-text { font-size: 1.2rem; margin-bottom: 20px; color: #ccc; }
        .btn-modal { width: 100%; margin-top: 10px; background: rgba(0, 242, 255, 0.2); border-color: var(--neon-blue); }
        .removing .shape { transform: scale(0) rotate(180deg); opacity: 0; transition: transform 0.4s, opacity 0.4s; }
        @keyframes appearPop { 0% { transform: scale(0); opacity: 0; } 70% { transform: scale(1.15); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        .shape.appearing { animation: appearPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .shake { animation: sk 0.4s linear; }
        @keyframes sk { 0%,100%{transform:translate(0,0)} 25%{transform:translate(-3px,3px)} 75%{transform:translate(3px,-3px)} }
    </style>
</head>
<body oncontextmenu="return false;">
    <div id="orientation-warning">
        <h2 style="color: var(--neon-blue);">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h2>
        <p>–î–ª—è –∏–≥—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</p>
        <span style="font-size: 3rem;">üì±</span>
    </div>
    <div id="main-wrapper">
        <div class="top-panel">
            <div class="info-box"><span class="label">–£—Ä–æ–≤–µ–Ω—å</span><span class="value lvl-color" id="ui-level">1</span></div>
            <div class="info-box"><span class="label">–•–æ–¥—ã</span><span class="value" id="ui-moves">55</span></div>
            <div class="info-box"><span class="label">–¶–µ–ª—å</span><span class="value win-color" id="ui-goal">1000</span></div>
        </div>
        <div id="game-board"></div>
        <div class="controls">
            <button class="btn-bomb btn-action" id="btn-bomb">üí£ –í–∑—Ä—ã–≤ <span id="ui-bombs" style="margin-left:8px;">1</span></button>
            <button class="btn-restart btn-action" id="btn-restart">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
            <button class="btn-sound btn-icon" id="btn-sound">üîä</button>
        </div>
        <div id="modal-overlay">
            <div class="modal-content">
                <div class="modal-title" id="modal-title">Level Complete</div>
                <div class="modal-text" id="modal-text">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</div>
                <button class="btn-modal" id="btn-modal-next">–î–∞–ª–µ–µ</button>
            </div>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        window.yaContextCb = window.yaContextCb || [];
        window.oncontextmenu = function(event) { event.preventDefault(); event.stopPropagation(); return false; };

        const LEVELS = [{id:1,moves:55,goal:1000,bombs:1},{id:2,moves:53,goal:1500,bombs:2},{id:3,moves:50,goal:2000,bombs:3},{id:4,moves:48,goal:2500,bombs:4},{id:5,moves:46,goal:3000,bombs:5}];
        const ROWS = 8, COLS = 8, TYPES = 5;
        let currentLevelIdx = 0, moves = 0, score = 0, bombs = 0, goal = 0, grid = [], locked = false, audioCtx = null, isMuted = false;
        let touchStartX = 0, touchStartY = 0, activeRow = null, activeCol = null;
        const board = document.getElementById('game-board'), uiLevel = document.getElementById('ui-level'), uiMoves = document.getElementById('ui-moves'), uiGoal = document.getElementById('ui-goal'), uiBombs = document.getElementById('ui-bombs'), btnSound = document.getElementById('btn-sound'), btnRestart = document.getElementById('btn-restart'), modal = document.getElementById('modal-overlay'), modalTitle = document.getElementById('modal-title'), modalText = document.getElementById('modal-text'), btnModalNext = document.getElementById('btn-modal-next');

        function callAd(callback) {
            let callbackCalled = false;
            const finish = () => { if (!callbackCalled) { callbackCalled = true; callback(); } };
            const timeout = setTimeout(finish, 1500); 
            if (window.Ya && window.Ya.Context) {
                window.yaContextCb.push(() => {
                    Ya.Context.AdvManager.render({
                        blockId: 'R-M-18620204-1', type: 'interstitial',
                        onClose: () => { clearTimeout(timeout); finish(); },
                        onError: () => { clearTimeout(timeout); finish(); }
                    });
                });
            } else { finish(); }
        }

        function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); }
        function tone(type) {
            initAudio(); 
            if(!audioCtx || isMuted) return; const now = audioCtx.currentTime;
            if(type=='pop'){ let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.setValueAtTime(400,now);o.frequency.exponentialRampToValueAtTime(800,now+0.1);g.gain.value=0.1;o.start(now);o.stop(now+0.1); }
            else if(type=='match'){ let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='triangle';o.frequency.setValueAtTime(300,now);o.frequency.linearRampToValueAtTime(600,now+0.1);g.gain.value=0.1;o.start(now);o.stop(now+0.3); }
            else if(type=='win'){ let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='sine';o.frequency.setValueAtTime(400,now);o.frequency.linearRampToValueAtTime(800,now+0.3);g.gain.value=0.2;o.start(now);o.stop(now+0.5); }
            else if(type=='boom'){ let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='sine';o.frequency.setValueAtTime(200,now);o.frequency.exponentialRampToValueAtTime(10,now+0.5);g.gain.setValueAtTime(0.5,now);g.gain.exponentialRampToValueAtTime(0.01,now+0.5);o.start(now);o.stop(now+0.5); }
        }
        btnSound.onclick = () => { isMuted = !isMuted; btnSound.innerText = isMuted ? "üîá" : "üîä"; initAudio(); };
        function startLevel(idx) {
            if (idx >= LEVELS.length) { showModal("–ü–æ–±–µ–¥–∞!", "–í—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!", "–° –Ω–∞—á–∞–ª–∞", () => startLevel(0)); return; }
            currentLevelIdx = idx; const cfg = LEVELS[idx]; moves = cfg.moves; goal = cfg.goal; bombs = cfg.bombs; score = 0; locked = false;
            modal.style.display = 'none'; createBoardOnce(); createGridData(); render(true); updateUI();
        }
        function createBoardOnce() { board.innerHTML = ""; for(let r=0; r<ROWS; r++) for(let c=0; c<COLS; c++){ let cell = document.createElement('div'); cell.className = 'cell'; cell.dataset.r = r; cell.dataset.c = c; addSwipe(cell, r, c); board.appendChild(cell); } }
        function createGridData() { grid = []; for (let r = 0; r < ROWS; r++) { let row = []; for (let c = 0; c < COLS; c++) { let val; do { val = Math.floor(Math.random() * TYPES) + 1; } while ((r>=2 && grid[r-1][c]===val && grid[r-2][c]===val) || (c>=2 && row[c-1]===val && row[c-2]===val)); row.push(val); } grid.push(row); } }
        function render(isFirstRender = false) {
            for(let r=0; r<ROWS; r++) for(let c=0; c<COLS; c++){
                const cell = board.children[r * COLS + c], val = grid[r][c]; let shape = cell.querySelector('.shape');
                if (val > 0) {
                    if (!shape) { shape = document.createElement('div'); shape.className = 'shape type-' + val + (isFirstRender ? '' : ' appearing'); let inner = document.createElement('div'); inner.className = 'shape-inner'; shape.appendChild(inner); cell.appendChild(shape); }
                    else { shape.className = 'shape type-' + val; } cell.classList.remove('removing', 'top-layer', 'bot-layer'); shape.style.transform = '';
                } else if (shape && !cell.classList.contains('removing')) cell.removeChild(shape);
            }
        }
        function updateUI() { uiLevel.innerText = currentLevelIdx + 1; uiMoves.innerText = moves; uiGoal.innerText = Math.max(0, goal - score); uiBombs.innerText = bombs; }
        function checkWinCondition() {
            if (score >= goal) { locked = true; tone('win'); setTimeout(() => showModal(`–£—Ä–æ–≤–µ–Ω—å ${currentLevelIdx + 1} –ø—Ä–æ–π–¥–µ–Ω!`, `–°—á–µ—Ç: ${score}`, "–î–∞–ª–µ–µ", () => callAd(() => startLevel(currentLevelIdx + 1))), 500); }
            else if (moves <= 0) { locked = true; setTimeout(() => showModal("–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã", "–ù–µ—Ç —Ö–æ–¥–æ–≤", "–ù–æ–≤–∞—è –∏–≥—Ä–∞", () => callAd(() => startLevel(0))), 500); }
        }
        function showModal(title, text, btnText, action) { modalTitle.innerText = title; modalText.innerText = text; btnModalNext.innerText = btnText; btnModalNext.onclick = action; modal.style.display = 'flex'; }
        function addSwipe(el, r, c) { el.addEventListener('mousedown', e => { if(locked) return; initAudio(); touchStartX = e.clientX; touchStartY = e.clientY; activeRow = r; activeCol = c; }); el.addEventListener('touchstart', e => { if(locked) return; initAudio(); touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; activeRow = r; activeCol = c; }); }
        document.addEventListener('mouseup', e => { if(locked || activeRow === null) return; handleMove(e.clientX, e.clientY); });
        document.addEventListener('touchend', e => { if(locked || activeRow === null) return; handleMove(e.changedTouches[0].clientX, e.changedTouches[0].clientY); });
        function handleMove(endX, endY) {
            const dx = endX - touchStartX, dy = endY - touchStartY;
            if(Math.abs(dx) > 30 || Math.abs(dy) > 30) {
                let tr = activeRow, tc = activeCol; if(Math.abs(dx) > Math.abs(dy)) tc += dx > 0 ? 1 : -1; else tr += dy > 0 ? 1 : -1;
                if(tr >= 0 && tr < ROWS && tc >= 0 && tc < COLS) attemptSwap({r:activeRow, c:activeCol}, {r:tr, c:tc});
            } activeRow = null;
        }
        function attemptSwap(p1, p2) {
            locked = true; const cell1 = board.children[p1.r*COLS+p1.c], cell2 = board.children[p2.r*COLS+p2.c], s1 = cell1.querySelector('.shape'), s2 = cell2.querySelector('.shape');
            if(!s1 || !s2) { locked = false; return; }
            s1.style.transform = `translate(${cell2.offsetLeft-cell1.offsetLeft}px, ${cell2.offsetTop-cell1.offsetTop}px)`;
            s2.style.transform = `translate(${cell1.offsetLeft-cell2.offsetLeft}px, ${cell1.offsetTop-cell2.offsetTop}px)`;
            setTimeout(() => {
                [grid[p1.r][p1.c], grid[p2.r][p2.c]] = [grid[p2.r][p2.c], grid[p1.r][p1.c]];
                if(findMatches().length > 0) { 
                    moves--; 
                    tone('pop'); 
                    render(); 
                    runGameLoop(); 
                }
                else { 
                    // –ü–†–ê–í–ö–ê: –°–ø–∏—Å—ã–≤–∞–µ–º —Ö–æ–¥ –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ
                    moves--; 
                    [grid[p1.r][p1.c], grid[p2.r][p2.c]] = [grid[p2.r][p2.c], grid[p1.r][p1.c]]; 
                    s1.style.transform = ''; 
                    s2.style.transform = ''; 
                    updateUI(); 
                    locked = false; 
                    checkWinCondition(); 
                }
            }, 250);
        }
        function runGameLoop() {
            let matches = findMatches();
            if(matches.length > 0) {
                score += matches.length * 10; matches.forEach(p => board.children[p.r*COLS+p.c].classList.add('removing')); updateUI();
                setTimeout(() => { matches.forEach(p => grid[p.r][p.c] = 0); applyGravity(); render(); setTimeout(runGameLoop, 400); }, 400);
            } else { locked = false; checkWinCondition(); }
        }
        function applyGravity() { for(let c=0; c<COLS; c++) { let col = []; for(let r=0; r<ROWS; r++) if(grid[r][c] !== 0) col.push(grid[r][c]); let miss = ROWS-col.length; for(let r=0; r<ROWS; r++) grid[r][c] = r<miss ? Math.floor(Math.random()*TYPES)+1 : col[r-miss]; } }
        function findMatches() {
            let m = [];
            for(let r=0;r<ROWS;r++) for(let c=0;c<COLS-2;c++) if(grid[r][c]>0 && grid[r][c]==grid[r][c+1] && grid[r][c]==grid[r][c+2]) m.push({r,c},{r,c:c+1},{r,c:c+2});
            for(let c=0;c<COLS;c++) for(let r=0;r<ROWS-2;r++) if(grid[r][c]>0 && grid[r][c]==grid[r+1][c] && grid[r][c]==grid[r+2][c]) m.push({r,c},{r:r+1,c},{r:r+2,c});
            return m;
        }
        
        // –ü–†–ê–í–ö–ê: –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –ù–û–í–ê–Ø –ò–ì–†–ê –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å 0 (–ø–µ—Ä–≤—ã–π)
        btnRestart.onclick = () => callAd(() => startLevel(0));
        
        document.getElementById('btn-bomb').onclick = () => {
            if(locked || bombs<=0) return; bombs--; updateUI(); 
            tone('boom'); 
            board.classList.add('shake'); setTimeout(()=>board.classList.remove('shake'), 400);
            for(let i=0; i<5; i++){ let r=Math.floor(Math.random()*ROWS), c=Math.floor(Math.random()*COLS); grid[r][c]=0; score+=10; }
            render(); 
            locked = true; 
            setTimeout(() => {
                applyGravity(); 
                render(); 
                setTimeout(runGameLoop, 400); 
            }, 400);
        };
        startLevel(0);
    });
</script>
</body>
</html>